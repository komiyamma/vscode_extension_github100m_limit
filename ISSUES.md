# 既知の課題（現状）

このドキュメントは、`github100mbyteslimithook` 拡張の現状で未解決の課題のみを記載しています。実装で解決済みの項目は整理・削除しました。

---

## 改善提案 (Improvement Suggestions)

### 1. 依存関係の健全性

- 問題点: `package.json` の依存/開発依存には、間接依存も含め脆弱性が含まれる可能性があります。
- 影響: セキュリティ・メンテナンスコストの増大につながる可能性があります。
- 解決策: `npm audit` や Dependabot での監視を行い、必要に応じてパッケージのアップデートを行う。

---

## 主要な問題 (Major Issues)

### 1. `pre-commit-hook.sh` のクロスプラットフォーム非互換性

-   **問題点**: `pre-commit-hook.sh` 内で使用されている `stat -c %s "$file"` は、GNU/Linux環境で標準のコマンドです。macOS/BSD系のOSでは `stat -f %z "$file"` を使用する必要があり、現在のスクリプトはそのままでは動作しません。
-   **影響**: `README.md`ではWindows環境をメインターゲットとしていますが、macOSや他のUnix系OSのユーザーがこの拡張機能を利用しようとすると、pre-commitフックがエラーで失敗します。また、Windows上であっても、Git for Windowsに付属するGit Bash以外のシェル環境（Cygwinなど）では`stat`コマンドの挙動が異なる可能性があります。
-   **解決策**: `git cat-file -p :0:"$file" | wc -c` のように、Gitに組み込まれているプラットフォーム非依存のコマンドを使用してファイルサイズを取得するようスクリプトを修正することが推奨されます。

### 2. ファイルサイズのチェックロジックの不備

-   **問題点**: 現在のスクリプトは、作業ディレクトリ（working directory）に存在するファイルのサイズをチェックしています。しかし、Gitのコミットはインデックス（ステージングエリア）にあるコンテンツを対象とします。
-   **影響**: このロジックでは、以下のようなケースでファイルサイズのチェックが正しく機能しません。
    1.  巨大なファイルをステージング (`git add largefile`) した後にそのファイルを削除 (`rm largefile`) してコミットした場合: `stat`コマンドはファイルを見つけられず、サイズチェックを素通りしてしまいます。
    2.  巨大なファイルをステージング (`git add file`) した後にそのファイルの内容を小さなサイズに変更してコミットした場合: スクリプトは変更後の小さなファイルサイズをチェックするため、本来ブロックされるべきコミットが許可されてしまいます。
-   **解決策**: 作業ディレクトリではなく、インデックスにステージングされたオブジェクトのサイズを取得する必要があります。具体的には `git diff --cached --name-only -z | xargs -0 -I % sh -c 'git cat-file -p :0:"%" | wc -c'` のようなコマンドで、ステージングされた各ファイルの内容そのもののサイズを計測する方法が考えられます。

---

## マイナーな問題 (Minor Issues)

現時点では特になし。
